<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API å³æ™‚è¨ºæ–·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        #map { height: 400px; width: 100%; margin: 20px 0; border: 2px solid #ddd; }
        #streetview { height: 400px; width: 100%; margin: 20px 0; border: 2px solid #ddd; }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Google Maps API å³æ™‚è¨ºæ–·</h1>

        <div id="console-log" class="log">è¨ºæ–·é–‹å§‹...\n</div>

        <div id="status-container">
            <div id="loading-status" class="status warning">â³ æ­£åœ¨è¼‰å…¥ API...</div>
        </div>

        <button onclick="testBasicMap()">æ¸¬è©¦åŸºæœ¬åœ°åœ–</button>
        <button onclick="testStreetView()">æ¸¬è©¦è¡—æ™¯</button>
        <button onclick="testGeometry()">æ¸¬è©¦å¹¾ä½•è¨ˆç®—</button>
        <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>

        <div id="map"></div>
        <div id="streetview"></div>

        <div id="detailed-info" style="margin-top: 20px;"></div>
    </div>

    <script>
        let logElement = document.getElementById('console-log');
        let map, streetView;

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colorCode = {
                'info': '#3498db',
                'success': '#2ecc71',
                'error': '#e74c3c',
                'warning': '#f39c12'
            }[type] || '#ecf0f1';

            logElement.innerHTML += `<span style="color: ${colorCode}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateStatus(message, type) {
            const statusContainer = document.getElementById('status-container');
            statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearLog() {
            logElement.innerHTML = 'æ—¥èªŒå·²æ¸…é™¤...\n';
        }

        // å…¨åŸŸéŒ¯èª¤æ•ç²
        window.onerror = function(msg, url, line, col, error) {
            log(`JavaScript éŒ¯èª¤: ${msg} (è¡Œ ${line})`, 'error');
            return false;
        };

        // API è¼‰å…¥å›èª¿
        function initDiagnosis() {
            log('ğŸ” é–‹å§‹ API è¨ºæ–·', 'info');

            if (typeof google === 'undefined') {
                log('âŒ Google å°è±¡æœªå®šç¾©', 'error');
                updateStatus('âŒ Google Maps API è¼‰å…¥å¤±æ•—', 'error');
                return;
            }

            if (typeof google.maps === 'undefined') {
                log('âŒ google.maps æœªå®šç¾©', 'error');
                updateStatus('âŒ Maps å°è±¡è¼‰å…¥å¤±æ•—', 'error');
                return;
            }

            log('âœ… Google Maps API è¼‰å…¥æˆåŠŸ', 'success');
            updateStatus('âœ… API è¼‰å…¥æˆåŠŸï¼å¯ä»¥é–‹å§‹æ¸¬è©¦', 'success');

            // æª¢æŸ¥å¯ç”¨çš„æœå‹™
            const services = ['Map', 'StreetViewPanorama', 'Marker', 'geometry'];
            services.forEach(service => {
                if (service === 'geometry') {
                    if (google.maps.geometry && google.maps.geometry.spherical) {
                        log(`âœ… ${service} æœå‹™å¯ç”¨`, 'success');
                    } else {
                        log(`âŒ ${service} æœå‹™ä¸å¯ç”¨`, 'error');
                    }
                } else if (google.maps[service]) {
                    log(`âœ… ${service} æœå‹™å¯ç”¨`, 'success');
                } else {
                    log(`âŒ ${service} æœå‹™ä¸å¯ç”¨`, 'error');
                }
            });

            showDetailedInfo();
        }

        function showDetailedInfo() {
            const info = document.getElementById('detailed-info');
            info.innerHTML = `
                <div class="status info">
                    <h3>ğŸ“Š API è©³ç´°è³‡è¨Š</h3>
                    <p><strong>ç‰ˆæœ¬:</strong> ${google.maps.version || 'æœªçŸ¥'}</p>
                    <p><strong>è¼‰å…¥åº«:</strong> ${google.maps.modules ? Object.keys(google.maps.modules).join(', ') : 'ç„¡'}</p>
                    <p><strong>ç•¶å‰æ™‚é–“:</strong> ${new Date().toLocaleString()}</p>
                    <p><strong>ç”¨æˆ¶ä»£ç†:</strong> ${navigator.userAgent.substring(0, 100)}...</p>
                </div>
            `;
        }

        function testBasicMap() {
            log('ğŸ—ºï¸ æ¸¬è©¦åŸºæœ¬åœ°åœ–åŠŸèƒ½...', 'info');

            try {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 8,
                    center: { lat: 25.0330, lng: 121.5654 }, // å°åŒ—
                    mapTypeId: 'roadmap'
                });

                log('âœ… åœ°åœ–å‰µå»ºæˆåŠŸ', 'success');

                // æ·»åŠ æ¨™è¨˜æ¸¬è©¦
                const marker = new google.maps.Marker({
                    position: { lat: 25.0330, lng: 121.5654 },
                    map: map,
                    title: 'æ¸¬è©¦æ¨™è¨˜'
                });

                log('âœ… æ¨™è¨˜æ·»åŠ æˆåŠŸ', 'success');

                // åœ°åœ–äº‹ä»¶æ¸¬è©¦
                map.addListener('click', function(event) {
                    log(`ğŸ–±ï¸ åœ°åœ–é»æ“Š: ${event.latLng.lat()}, ${event.latLng.lng()}`, 'info');
                });

                log('âœ… åœ°åœ–äº‹ä»¶ç¶å®šæˆåŠŸ', 'success');

            } catch (error) {
                log(`âŒ åœ°åœ–æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function testStreetView() {
            log('ğŸ™ï¸ æ¸¬è©¦è¡—æ™¯åŠŸèƒ½...', 'info');

            try {
                streetView = new google.maps.StreetViewPanorama(
                    document.getElementById('streetview'), {
                        position: { lat: 25.0330, lng: 121.5654 },
                        pov: {
                            heading: 34,
                            pitch: 10
                        },
                        zoom: 1
                    }
                );

                log('âœ… è¡—æ™¯å‰µå»ºæˆåŠŸ', 'success');

                // è¡—æ™¯äº‹ä»¶æ¸¬è©¦
                streetView.addListener('position_changed', function() {
                    log('ğŸ“ è¡—æ™¯ä½ç½®è®Šæ›´', 'info');
                });

                log('âœ… è¡—æ™¯äº‹ä»¶ç¶å®šæˆåŠŸ', 'success');

            } catch (error) {
                log(`âŒ è¡—æ™¯æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function testGeometry() {
            log('ğŸ“ æ¸¬è©¦å¹¾ä½•è¨ˆç®—åŠŸèƒ½...', 'info');

            try {
                if (!google.maps.geometry || !google.maps.geometry.spherical) {
                    throw new Error('å¹¾ä½•åº«æœªè¼‰å…¥');
                }

                const pos1 = new google.maps.LatLng(25.0330, 121.5654);
                const pos2 = new google.maps.LatLng(35.6762, 139.6503);

                const distance = google.maps.geometry.spherical.computeDistanceBetween(pos1, pos2);

                log(`âœ… è·é›¢è¨ˆç®—æˆåŠŸ: ${Math.round(distance / 1000)} å…¬é‡Œ`, 'success');

            } catch (error) {
                log(`âŒ å¹¾ä½•æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // API èªè­‰å¤±æ•—è™•ç†
        function gm_authFailure() {
            log('âŒ API èªè­‰å¤±æ•—', 'error');
            updateStatus('âŒ API èªè­‰å¤±æ•— - æª¢æŸ¥é‡‘é‘°è¨­å®š', 'error');
        }

        // API è¼‰å…¥éŒ¯èª¤è™•ç†
        function onApiError() {
            log('âŒ API è¼‰å…¥éŒ¯èª¤', 'error');
            updateStatus('âŒ API è¼‰å…¥å¤±æ•— - æª¢æŸ¥ç¶²è·¯é€£ç·š', 'error');
        }

        // è¨­å®šå…¨åŸŸå‡½æ•¸
        window.initDiagnosis = initDiagnosis;
        window.gm_authFailure = gm_authFailure;

        log('ğŸ“ è¨ºæ–·å·¥å…·è¼‰å…¥å®Œæˆ', 'info');
        log('â³ ç­‰å¾… Google Maps API è¼‰å…¥...', 'warning');
    </script>

    <!-- Google Maps API è¼‰å…¥ï¼Œæ–°å¢æ›´å¤šéŒ¯èª¤è™•ç† -->
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkb3gNyldoHpt7IwyduZtXQ2Br1K0ooc0&libraries=geometry&callback=initDiagnosis"
            onerror="onApiError()">
    </script>
</body>
</html>

