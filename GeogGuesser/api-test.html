<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .warning { background: #fff3cd; border-color: #ffeaa7; color: #856404; }
        #map, #streetview {
            height: 300px;
            width: 100%;
            margin: 10px 0;
            border: 2px solid #ddd;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Google Maps API å®Œæ•´æ¸¬è©¦</h1>

        <div id="api-status" class="test-section warning">
            â³ æ­£åœ¨æª¢æ¸¬ API è¼‰å…¥ç‹€æ…‹...
        </div>

        <div class="test-section">
            <h3>æ§åˆ¶å°æ—¥èªŒ</h3>
            <div id="log" class="log">é–‹å§‹ API æ¸¬è©¦...\n</div>
            <button onclick="clearLog()">æ¸…é™¤æ—¥èªŒ</button>
        </div>

        <div class="test-section">
            <h3>æ¸¬è©¦æŒ‰éˆ•</h3>
            <button onclick="testBasicMap()">æ¸¬è©¦åŸºæœ¬åœ°åœ–</button>
            <button onclick="testStreetView()">æ¸¬è©¦è¡—æ™¯</button>
            <button onclick="testGeometry()">æ¸¬è©¦è·é›¢è¨ˆç®—</button>
            <button onclick="testAllServices()">å®Œæ•´æ¸¬è©¦</button>
        </div>

        <div class="test-section">
            <h3>åœ°åœ–æ¸¬è©¦</h3>
            <div id="map"></div>
        </div>

        <div class="test-section">
            <h3>è¡—æ™¯æ¸¬è©¦</h3>
            <div id="streetview"></div>
        </div>

        <div id="results" class="test-section" style="display: none;">
            <h3>æ¸¬è©¦çµæœ</h3>
            <div id="test-results"></div>
        </div>
    </div>

    <script>
        let logElement = document.getElementById('log');
        let map, streetView;
        let testResults = {};

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'info': '#3498db',
                'success': '#2ecc71',
                'error': '#e74c3c',
                'warning': '#f39c12'
            };

            logElement.innerHTML += `<span style="color: ${colors[type] || colors.info}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            logElement.innerHTML = 'æ—¥èªŒå·²æ¸…é™¤...\n';
        }

        function updateApiStatus(message, type) {
            const statusDiv = document.getElementById('api-status');
            statusDiv.className = `test-section ${type}`;
            statusDiv.innerHTML = message;
        }

        function testBasicMap() {
            log('ğŸ—ºï¸ é–‹å§‹æ¸¬è©¦åŸºæœ¬åœ°åœ–åŠŸèƒ½...', 'info');

            try {
                if (!map) {
                    map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 2,
                        center: { lat: 25, lng: 0 },
                        mapTypeId: 'roadmap'
                    });
                }

                // æ·»åŠ æ¨™è¨˜æ¸¬è©¦
                const marker = new google.maps.Marker({
                    position: { lat: 25, lng: 0 },
                    map: map,
                    title: 'æ¸¬è©¦æ¨™è¨˜'
                });

                testResults.map = true;
                log('âœ… åœ°åœ–æ¸¬è©¦æˆåŠŸ', 'success');

            } catch (error) {
                testResults.map = false;
                log(`âŒ åœ°åœ–æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function testStreetView() {
            log('ğŸ“ é–‹å§‹æ¸¬è©¦è¡—æ™¯åŠŸèƒ½...', 'info');

            try {
                if (!streetView) {
                    streetView = new google.maps.StreetViewPanorama(
                        document.getElementById('streetview'), {
                            position: { lat: 35.6762, lng: 139.6503 }, // æ±äº¬å¡”
                            pov: { heading: 34, pitch: 10 },
                            disableDefaultUI: false
                        }
                    );
                }

                // æ¸¬è©¦è¡—æ™¯æœå‹™
                const streetViewService = new google.maps.StreetViewService();
                streetViewService.getPanorama({
                    location: { lat: 35.6762, lng: 139.6503 },
                    radius: 50,
                    source: google.maps.StreetViewSource.OUTDOOR
                }, (data, status) => {
                    if (status === 'OK') {
                        testResults.streetView = true;
                        log('âœ… è¡—æ™¯æ¸¬è©¦æˆåŠŸ', 'success');
                    } else {
                        testResults.streetView = false;
                        log(`âŒ è¡—æ™¯æœå‹™éŒ¯èª¤: ${status}`, 'error');
                    }
                });

            } catch (error) {
                testResults.streetView = false;
                log(`âŒ è¡—æ™¯æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function testGeometry() {
            log('ğŸ“ é–‹å§‹æ¸¬è©¦å¹¾ä½•è¨ˆç®—...', 'info');

            try {
                if (!google.maps.geometry || !google.maps.geometry.spherical) {
                    throw new Error('å¹¾ä½•åº«æœªè¼‰å…¥');
                }

                const point1 = new google.maps.LatLng(35.6762, 139.6503); // æ±äº¬
                const point2 = new google.maps.LatLng(40.7589, -73.9851); // ç´ç´„

                const distance = google.maps.geometry.spherical.computeDistanceBetween(point1, point2);
                const distanceKm = Math.round(distance / 1000);

                testResults.geometry = true;
                log(`âœ… è·é›¢è¨ˆç®—æˆåŠŸ: æ±äº¬åˆ°ç´ç´„ ${distanceKm} å…¬é‡Œ`, 'success');

            } catch (error) {
                testResults.geometry = false;
                log(`âŒ å¹¾ä½•è¨ˆç®—å¤±æ•—: ${error.message}`, 'error');
            }
        }

        function testAllServices() {
            log('ğŸ” é–‹å§‹å®Œæ•´æ¸¬è©¦...', 'info');

            testBasicMap();
            setTimeout(() => testStreetView(), 1000);
            setTimeout(() => testGeometry(), 2000);
            setTimeout(() => showResults(), 3000);
        }

        function showResults() {
            const resultsDiv = document.getElementById('test-results');
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(result => result).length;

            let html = `<h4>æ¸¬è©¦æ‘˜è¦: ${passedTests}/${totalTests} é€šé</h4>`;

            for (const [test, result] of Object.entries(testResults)) {
                const status = result ? 'âœ… é€šé' : 'âŒ å¤±æ•—';
                const testName = {
                    'map': 'åœ°åœ–æœå‹™',
                    'streetView': 'è¡—æ™¯æœå‹™',
                    'geometry': 'å¹¾ä½•è¨ˆç®—'
                }[test] || test;

                html += `<div>${testName}: ${status}</div>`;
            }

            resultsDiv.innerHTML = html;
            document.getElementById('results').style.display = 'block';

            log(`ğŸ“Š å®Œæ•´æ¸¬è©¦å®Œæˆ: ${passedTests}/${totalTests} é€šé`, passedTests === totalTests ? 'success' : 'warning');
        }

        // API è¼‰å…¥æª¢æ¸¬
        function checkApiLoad() {
            log('ğŸ” æª¢æŸ¥ Google Maps API è¼‰å…¥ç‹€æ…‹...', 'info');

            if (typeof google !== 'undefined' && google.maps) {
                updateApiStatus('âœ… Google Maps API è¼‰å…¥æˆåŠŸ', 'success');
                log('âœ… API è¼‰å…¥æˆåŠŸ', 'success');

                // æª¢æŸ¥å¿…è¦çš„æœå‹™
                const services = [];
                if (google.maps.Map) services.push('åœ°åœ–æœå‹™');
                if (google.maps.StreetViewPanorama) services.push('è¡—æ™¯æœå‹™');
                if (google.maps.geometry && google.maps.geometry.spherical) services.push('å¹¾ä½•åº«');

                log(`ğŸ“‹ å¯ç”¨æœå‹™: ${services.join(', ')}`, 'info');

            } else {
                updateApiStatus('âŒ Google Maps API è¼‰å…¥å¤±æ•—', 'error');
                log('âŒ API è¼‰å…¥å¤±æ•—', 'error');
            }
        }

        // éŒ¯èª¤è™•ç†
        function gm_authFailure() {
            updateApiStatus('âŒ API èªè­‰å¤±æ•—', 'error');
            log('âŒ Google Maps API èªè­‰å¤±æ•—', 'error');
            log('è«‹æª¢æŸ¥:', 'warning');
            log('1. API é‡‘é‘°æ˜¯å¦æ­£ç¢º', 'warning');
            log('2. Maps JavaScript API æ˜¯å¦å·²å•Ÿç”¨', 'warning');
            log('3. Street View Static API æ˜¯å¦å·²å•Ÿç”¨', 'warning');
            log('4. API é‡‘é‘°ä½¿ç”¨é™åˆ¶', 'warning');
        }

        window.gm_authFailure = gm_authFailure;
        window.addEventListener('load', () => {
            setTimeout(checkApiLoad, 1000);
        });
    </script>

    <!-- Google Maps API è¼‰å…¥ -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkb3gNyldoHpt7IwyduZtXQ2Br1K0ooc0&libraries=geometry&callback=checkApiLoad">
    </script>
</body>
</html>
