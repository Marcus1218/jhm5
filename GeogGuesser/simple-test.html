<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å–® API æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        #map {
            height: 300px;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Google Maps API ç°¡å–®æ¸¬è©¦</h1>

        <div id="step1" class="status warning">æ­¥é©Ÿ 1: æª¢æŸ¥ç¶²è·¯é€£ç·š...</div>
        <div id="step2" class="status warning">æ­¥é©Ÿ 2: è¼‰å…¥ Google Maps API...</div>
        <div id="step3" class="status warning">æ­¥é©Ÿ 3: æ¸¬è©¦åœ°åœ–åˆå§‹åŒ–...</div>

        <div id="error-details" style="display: none;">
            <h3>ğŸš¨ éŒ¯èª¤è©³æƒ…</h3>
            <div id="error-content"></div>
        </div>

        <div id="success-details" style="display: none;">
            <h3>âœ… æˆåŠŸï¼</h3>
            <p>Google Maps API å·¥ä½œæ­£å¸¸</p>
            <div id="map"></div>
        </div>

        <div id="instructions">
            <h3>ğŸ“‹ API è¨­å®šæª¢æŸ¥æ¸…å–®</h3>
            <p>å¦‚æœæ¸¬è©¦å¤±æ•—ï¼Œè«‹ç¢ºèªä»¥ä¸‹è¨­å®šï¼š</p>
            <ol>
                <li><strong>API é‡‘é‘°æ­£ç¢ºæ€§</strong>: AIzaSyCkb3gNyldoHpt7IwyduZtXQ2Br1K0ooc0</li>
                <li><strong>å·²å•Ÿç”¨çš„ API</strong>:
                    <ul>
                        <li>Maps JavaScript API</li>
                        <li>Street View Static API</li>
                    </ul>
                </li>
                <li><strong>HTTP å¼•è–¦è€…é™åˆ¶</strong>:
                    <ul>
                        <li>http://localhost:8000/*</li>
                        <li>http://127.0.0.1:8000/*</li>
                    </ul>
                </li>
            </ol>

            <p><a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="background: #007bff; color: white; padding: 10px 15px; text-decoration: none; border-radius: 5px;">ğŸ”§ å‰å¾€ Google Cloud Console</a></p>
        </div>
    </div>

    <script>
        let testStartTime = Date.now();

        function updateStep(stepId, message, type) {
            const element = document.getElementById(stepId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function showError(details) {
            document.getElementById('error-details').style.display = 'block';
            document.getElementById('error-content').innerHTML = details;
        }

        function showSuccess() {
            document.getElementById('success-details').style.display = 'block';
        }

        // æ­¥é©Ÿ 1: æª¢æŸ¥ç¶²è·¯
        updateStep('step1', 'æ­¥é©Ÿ 1: âœ… ç¶²è·¯é€£ç·šæ­£å¸¸', 'success');

        // æ­¥é©Ÿ 2: API è¼‰å…¥æª¢æŸ¥
        let apiLoadTimeout = setTimeout(() => {
            updateStep('step2', 'æ­¥é©Ÿ 2: âŒ API è¼‰å…¥è¶…æ™‚ (30ç§’)', 'error');
            updateStep('step3', 'æ­¥é©Ÿ 3: âŒ ç„¡æ³•é€²è¡Œæ¸¬è©¦', 'error');

            showError(`
                <div class="status error">
                    <strong>API è¼‰å…¥å¤±æ•—çš„å¯èƒ½åŸå› ï¼š</strong>
                    <ul>
                        <li>API é‡‘é‘°ç„¡æ•ˆæˆ–è¨­å®šéŒ¯èª¤</li>
                        <li>æœªå•Ÿç”¨ Maps JavaScript API</li>
                        <li>HTTP å¼•è–¦è€…é™åˆ¶è¨­å®šå•é¡Œ</li>
                        <li>ç¶²è·¯é€£ç·šå•é¡Œ</li>
                        <li>é…é¡å·²ç”¨å®Œ</li>
                    </ul>
                </div>

                <h4>ğŸ”§ ç«‹å³ä¿®å¾©æ­¥é©Ÿï¼š</h4>
                <ol>
                    <li>å‰å¾€ <a href="https://console.cloud.google.com/apis/library/maps-backend.googleapis.com" target="_blank">Google Cloud Console</a></li>
                    <li>ç¢ºèª Maps JavaScript API å·²å•Ÿç”¨</li>
                    <li>æª¢æŸ¥ API é‡‘é‘°çš„ HTTP å¼•è–¦è€…è¨­å®š</li>
                    <li>åŠ å…¥ä»¥ä¸‹åŸŸåé™åˆ¶ï¼š
                        <pre>http://localhost:8000/*
http://127.0.0.1:8000/*
localhost:8000/*
127.0.0.1:8000/*</pre>
                    </li>
                </ol>
            `);
        }, 30000); // 30ç§’è¶…æ™‚

        // Google Maps API è¼‰å…¥æˆåŠŸå›èª¿
        function initTestMap() {
            clearTimeout(apiLoadTimeout);

            updateStep('step2', 'æ­¥é©Ÿ 2: âœ… Google Maps API è¼‰å…¥æˆåŠŸ', 'success');

            try {
                // æ­¥é©Ÿ 3: æ¸¬è©¦åœ°åœ–å‰µå»º
                const map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 10,
                    center: { lat: 25.0330, lng: 121.5654 }, // å°åŒ—101
                });

                // æ·»åŠ æ¨™è¨˜
                new google.maps.Marker({
                    position: { lat: 25.0330, lng: 121.5654 },
                    map: map,
                    title: 'æ¸¬è©¦æˆåŠŸï¼é€™è£¡æ˜¯å°åŒ—101'
                });

                updateStep('step3', 'æ­¥é©Ÿ 3: âœ… åœ°åœ–åˆå§‹åŒ–æˆåŠŸ', 'success');
                showSuccess();

                const loadTime = Date.now() - testStartTime;
                console.log(`âœ… Google Maps API æ¸¬è©¦æˆåŠŸï¼Œè¼‰å…¥æ™‚é–“: ${loadTime}ms`);

            } catch (error) {
                updateStep('step3', `æ­¥é©Ÿ 3: âŒ åœ°åœ–åˆå§‹åŒ–å¤±æ•—`, 'error');
                showError(`
                    <div class="status error">
                        <strong>åœ°åœ–åˆå§‹åŒ–éŒ¯èª¤:</strong><br>
                        ${error.message}
                    </div>
                `);
                console.error('åœ°åœ–åˆå§‹åŒ–éŒ¯èª¤:', error);
            }
        }

        // è™•ç† API èªè­‰å¤±æ•—
        function handleAuthFailure() {
            clearTimeout(apiLoadTimeout);
            updateStep('step2', 'æ­¥é©Ÿ 2: âŒ API èªè­‰å¤±æ•—', 'error');
            updateStep('step3', 'æ­¥é©Ÿ 3: âŒ ç„¡æ³•é€²è¡Œæ¸¬è©¦', 'error');

            showError(`
                <div class="status error">
                    <strong>èªè­‰å¤±æ•—ï¼</strong> é€™æ˜¯æœ€å¸¸è¦‹çš„å•é¡Œã€‚
                </div>

                <h4>ğŸ”§ ä¿®å¾©æ­¥é©Ÿï¼š</h4>
                <ol>
                    <li><strong>æª¢æŸ¥ API é‡‘é‘°</strong>: ç¢ºèªè¤‡è£½æ­£ç¢º</li>
                    <li><strong>å•Ÿç”¨ API</strong>: åœ¨ Google Cloud Console ä¸­å•Ÿç”¨ "Maps JavaScript API"</li>
                    <li><strong>è¨­å®šåŸŸåé™åˆ¶</strong>:
                        <ul>
                            <li>å‰å¾€ <a href="https://console.cloud.google.com/apis/credentials" target="_blank">æ†‘è­‰é é¢</a></li>
                            <li>é»æ“Šä½ çš„ API é‡‘é‘°</li>
                            <li>é¸æ“‡ "HTTP å¼•è–¦è€… (ç¶²ç«™)"</li>
                            <li>åŠ å…¥: <code>http://localhost:8000/*</code></li>
                        </ul>
                    </li>
                </ol>
            `);
        }

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.gm_authFailure = handleAuthFailure;
        window.initTestMap = initTestMap;

        console.log('é–‹å§‹ Google Maps API æ¸¬è©¦...');
    </script>

    <!-- Google Maps API è¼‰å…¥ -->
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkb3gNyldoHpt7IwyduZtXQ2Br1K0ooc0&callback=initTestMap"
            onerror="handleAuthFailure()">
    </script>
</body>
</html>
